var JoyStick=function(t){function i(){i["super"](this),this._touchId=-1,this._radius=100,this._lastRad=-999,this._lastAngle=-999,this._debug=!1,this._curPos=new Laya.Point(0,0),this._originPos=new Laya.Point(Laya.stage.width/2,Laya.stage.height/2),this._touchWidth=Laya.stage.width,this._touchHeight=Laya.stage.height,this._buttonImg=null,this._backgroundImg=null,this._arrowImg=null,this._debugColor="#7ED321",this._debugTouchAreaColor="#D8D8D8",this.autoAlpha=!0,this.joystickAlpha=.4,this.fixedPosition=!0,this.arrow=new Laya.Sprite,this.button=new Laya.Sprite,this.background=new Laya.Sprite,this._init()}Laya["class"](i,"JoyStick",t);var a=i.prototype;return a._init=function(){this.setTouchSize(),this.addChild(this.background),this.addChild(this.button),this.addChild(this.arrow),this.arrow.visible=!1,this.autoAlpha&&(this.alpha=this.joystickAlpha),this.on(Laya.Event.MOUSE_DOWN,this,this.onTouchDown),this.on(Laya.Event.MOUSE_MOVE,this,this.onTouchMove),this.on(Laya.Event.MOUSE_UP,this,this.onTouchUp)},a.onTouchDown=function(t){if(-1===this._touchId){this.alpha=1,this._touchId=t.touchId;var i=this.globalToLocal(new Laya.Point(t.stageX,t.stageY));this.arrow.visible=!0,this.fixedPosition||(this._curPos.x=i.x,this._curPos.y=i.y,this.button.pos(this._curPos.x,this._curPos.y),this.background.pos(this._curPos.x,this._curPos.y),this.arrow.pos(this._curPos.x,this._curPos.y)),this.event("down"),-999!==this._lastAngle&&-999!==this._lastRad&&this.event("move",[this._lastAngle,this._lastRad])}},a.onTouchMove=function(t){if(t.touchId===this._touchId){var i,a=this.globalToLocal(new Laya.Point(t.stageX,t.stageY));i=this.fixedPosition?new Laya.Point(this._originPos.x,this._originPos.y):new Laya.Point(this._curPos.x,this._curPos.y);var s=a.x-i.x,h=a.y-i.y,o=Math.atan2(h,s),e=180*o/Math.PI;this._lastRad=o,this._lastAngle=e,a.distance(i.x,i.y)<=this._radius?this.button.pos(a.x,a.y):this.button.pos(this._radius*Math.cos(o)+i.x,this._radius*Math.sin(o)+i.y),this.arrow.rotation=e+90,this.event("move",[e,o])}},a.onTouchUp=function(t){t.touchId===this._touchId&&(this.autoAlpha?this.alpha=this.joystickAlpha:this.alpha=1,this.arrow.pos(this._originPos.x,this._originPos.y),this.button.pos(this._originPos.x,this._originPos.y),this.background.pos(this._originPos.x,this._originPos.y),this.arrow.visible=!1,this._touchId=-1,this.event("up"))},a.setImg=function(t,i,a){this._buttonImg=t,this._backgroundImg=i,this._arrowImg=a,this._draw()},a.setOriginPos=function(t,i){this._originPos.x=t,this._originPos.y=i,this.button.pos(this._originPos.x,this._originPos.y),this.background.pos(this._originPos.x,this._originPos.y),this.arrow.pos(this._originPos.x,this._originPos.y)},a.setRadius=function(t){this._radius=t,this._draw()},a.setTouchSize=function(t,i){this._touchWidth=t||this._touchWidth,this._touchHeight=i||this._touchHeight,this.size(this._touchWidth,this._touchHeight),this._draw()},a.fixRadius=function(){if(this._backgroundImg){var t=Laya.loader.getRes(this._backgroundImg);this._radius=t.width/2,this._draw()}},a.setDebug=function(t){this._debug=t,this._draw()},a._draw=function(){if(this._clearDraw(),this._debug&&this._drawDebug(),this._buttonImg){var t=Laya.loader.getRes(this._buttonImg);this.button.graphics.drawTexture(t,-t.width/2,-t.height/2)}if(this._backgroundImg){var t=Laya.loader.getRes(this._backgroundImg);this.background.graphics.drawTexture(t,-t.width/2,-t.height/2)}if(this._arrowImg){var t=Laya.loader.getRes(this._arrowImg);this.arrow.graphics.drawTexture(t,-t.width/2,-t.height/2)}},a._drawDebug=function(){this.background.graphics.drawCircle(0,0,this._radius,null,this._debugColor,15),this.button.graphics.drawCircle(0,0,30,this._debugColor),this.arrow.graphics.drawPoly(0,0,[-30,-1*(this._radius-30),0,-1*(this._radius+30),30,-1*(this._radius-30)],this._debugColor),this.graphics.drawRect(0,0,this._touchWidth,this._touchHeight,this._debugTouchAreaColor)},a._clearDraw=function(){this.graphics.clear(),this.arrow.graphics.clear(),this.button.graphics.clear(),this.background.graphics.clear()},i}(Laya.Sprite);!function(){function t(){var t=[{url:"res/atlas/joystick.json",type:Laya.Loader.ATLAS},{url:"res/atlas/comp.json",type:Laya.Loader.ATLAS}];Laya.loader.load(t,Laya.Handler.create(this,i))}function i(){var t=new Laya.Text;t.text="0",t.pos(Laya.stage.width/4,Laya.stage.width/2),t.fontSize=50,t.color="#ffffff",t.pivot(t.width/2,t.height/2),Laya.stage.addChild(t);var i=new Laya.Text;i.text="0",i.pos(Laya.stage.width/4*3,Laya.stage.width/2),i.fontSize=50,i.color="#ffffff",i.pivot(i.width/2,i.height/2),Laya.stage.addChild(i);var a=new JoyStick;a.pos(0,Laya.stage.width),a.setTouchSize(Laya.stage.width/2,Laya.stage.height-Laya.stage.width),a.setOriginPos(Laya.stage.width/4,(Laya.stage.height-Laya.stage.width)/2),a.fixRadius(),a.setDebug(!0),a.on("move",this,function(i,a){t.text=i.toFixed(2)+"",t.pivot(t.width/2,t.height/2)}),Laya.stage.addChild(a);var s=new JoyStick;s.pos(Laya.stage.width/2,Laya.stage.width),s.setTouchSize(Laya.stage.width/2,Laya.stage.height-Laya.stage.width),s.setOriginPos(Laya.stage.width/4,(Laya.stage.height-Laya.stage.width)/2),s.fixRadius(),s.setDebug(!0),s.on("move",this,function(t,a){i.text=t.toFixed(2)+"",i.pivot(i.width/2,i.height/2)}),Laya.stage.addChild(s);var h=new Laya.Button("comp/button.png");h.width=160,h.height=40,h.label="debug:已开",h.labelSize=30,h.pos(Laya.stage.width/4,20),h.pivot(h.width/2,0),h.on(Laya.Event.CLICK,this,function(t){"debug:已开"==h.label?(a.setDebug(!1),s.setDebug(!1),h.label="debug:已关"):(a.setDebug(!0),s.setDebug(!0),h.label="debug:已开")}),Laya.stage.addChild(h);var o=new Laya.Button("comp/button.png");o.width=160,o.height=40,o.label="皮肤:已关",o.labelSize=30,o.pos(Laya.stage.width/4*3,20),o.pivot(o.width/2,0),o.on(Laya.Event.CLICK,this,function(t){"皮肤:已关"==o.label?(a.setImg("joystick/button.png","joystick/background.png","joystick/arrow.png"),a.fixRadius(),s.setImg("joystick/button.png","joystick/background.png","joystick/arrow.png"),s.fixRadius(),o.label="皮肤:已开"):(a.setImg(),s.setImg(),o.label="皮肤:已关")}),Laya.stage.addChild(o)}!function(){Laya.init(600,900),Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_WIDTH,Laya.stage.alignH=Laya.Stage.ALIGN_CENTER,Laya.stage.alignV=Laya.Stage.ALIGN_MIDDLE,Laya.stage.screenMode=Laya.Stage.SCREEN_VERTICAL,t()}()}();